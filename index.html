<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>4x4 Image Puzzle Game - Multi Level</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px;
    background-color: #a3c9f1; /* Solid light blue background */
    min-height: 100vh;
  }
  h1 {
    margin-bottom: 0.2em;
  }
  #levelInfo {
    margin-bottom: 1em;
    font-size: 1.2em;
  }
  #preview {
    width: 200px;
    height: 200px;
    border: 2px solid #333;
    margin-bottom: 20px;
    object-fit: cover;
  }
  #puzzle {
    width: 400px;
    height: 400px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: 2px;
    border: 2px solid #333;
  }
  .tile {
    width: 100%;
    height: 100%;
    background-size: 400px 400px;
    cursor: pointer;
    border: 1px solid #ccc;
    box-sizing: border-box;
    transition: outline 0.3s ease;
  }
  .selected {
    outline: 3px solid #ff5722;
  }
  #message {
    margin-top: 1em;
    font-size: 1.2em;
    height: 1.4em;
    color: green;
  }
  #shuffleBtn {
    margin-top: 1em;
    padding: 10px 20px;
    font-size: 1em;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>4x4 Image Puzzle Game</h1>
<!-- Solved Image Preview -->
<img id="preview" src="" alt="Solved Puzzle Preview" />
<div id="levelInfo">Level: 1 / 6</div>
<div id="puzzle"></div>
<button id="shuffleBtn">Shuffle</button>
<div id="message"></div>

<script>
  const puzzle = document.getElementById('puzzle');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const message = document.getElementById('message');
  const levelInfo = document.getElementById('levelInfo');
  const preview = document.getElementById('preview');

  const gridSize = 4;
  const tileCount = gridSize * gridSize;

  // Images for levels - replace URLs with your local files if needed
  const images = [
    'puzzle.jpg',       // Your local images here (make sure they exist)
    'puzzle2.jpg',
    'puzzle3.jpg',
    'puzzle4.jpg',
    'puzzle5.jpg',
    'puzzle6.jpg',
  ];

  // Fallback images in case your local images don't load (optional)
  const fallbackImages = [
    'https://picsum.photos/id/1015/400/400',
    'https://picsum.photos/id/1016/400/400',
    'https://picsum.photos/id/1018/400/400',
    'https://picsum.photos/id/1020/400/400',
    'https://picsum.photos/id/1024/400/400',
    'https://picsum.photos/id/1027/400/400',
  ];

  let currentLevel = 0;  // index from 0 to 5
  let tiles = [];        // Array of tile divs
  let positions = [];    // positions[i] = index of tile at position i
  let firstSelected = null;

  // Create tiles with correct background positions for current image
  function createTiles() {
    puzzle.innerHTML = '';
    tiles = [];
    positions = [];

    // Use local image if assumed to exist, else fallback image
    const imageURL = images[currentLevel];
    const imageToUse = imageExists(imageURL) ? imageURL : fallbackImages[currentLevel];

    for(let i = 0; i < tileCount; i++) {
      const tile = document.createElement('div');
      tile.classList.add('tile');
      tile.dataset.correctIndex = i;  // This tile shows this piece of image
      tile.style.backgroundImage = `url('${imageToUse}')`;
      tile.style.backgroundPosition = `-${(i % gridSize) * (400 / gridSize)}px -${Math.floor(i / gridSize) * (400 / gridSize)}px`;
      tile.style.backgroundSize = '400px 400px';

      tile.addEventListener('click', onTileClick);
      tiles.push(tile);
      positions.push(i);  // Initially, tile i is at position i
      puzzle.appendChild(tile);
    }
  }

  // Dummy function, assume local images exist
  function imageExists(url) {
    if(!url.startsWith('http')) return true; // assume local images exist
    return true; // always true for remote images here
  }

  // Render tiles in order based on positions array
  function renderTiles() {
    puzzle.innerHTML = '';
    for(let pos = 0; pos < tileCount; pos++) {
      puzzle.appendChild(tiles[positions[pos]]);
    }
  }

  // Shuffle positions array with Fisher-Yates shuffle
  function shufflePositions() {
    for(let i = tileCount - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [positions[i], positions[j]] = [positions[j], positions[i]];
    }
  }

  // Shuffle tiles and render them
  function shuffleTiles() {
    shufflePositions();
    renderTiles();
    message.textContent = '';
    firstSelected = null;
  }

  // Handle tile clicks for swapping
  function onTileClick(e) {
    const clickedTile = e.target;

    if(firstSelected === null) {
      firstSelected = clickedTile;
      firstSelected.classList.add('selected');
    } else if (firstSelected === clickedTile) {
      // deselect
      firstSelected.classList.remove('selected');
      firstSelected = null;
    } else {
      // swap tiles in positions array
      const firstPos = positions.indexOf(tiles.indexOf(firstSelected));
      const secondPos = positions.indexOf(tiles.indexOf(clickedTile));

      [positions[firstPos], positions[secondPos]] = [positions[secondPos], positions[firstPos]];

      renderTiles();

      firstSelected.classList.remove('selected');
      firstSelected = null;

      if(checkSolved()) {
        if(currentLevel < images.length - 1) {
          message.textContent = `Well done! Level ${currentLevel + 1} solved! Next level loading...`;
          shuffleBtn.disabled = true;
          setTimeout(() => {
            currentLevel++;
            startLevel();
            shuffleBtn.disabled = false;
          }, 1500);
        } else {
          message.textContent = 'ðŸŽ‰ Congratulations! You completed all levels!';
          shuffleBtn.disabled = true;
        }
      }
    }
  }

  // Check if the puzzle is solved
  function checkSolved() {
    for(let i = 0; i < tileCount; i++) {
      if(positions[i] !== i) return false;
    }
    return true;
  }

  // Start current level
  function startLevel() {
    levelInfo.textContent = `Level: ${currentLevel + 1} / ${images.length}`;
    message.textContent = '';
    preview.src = images[currentLevel]; // set solved image preview
    createTiles();
    shuffleTiles();
  }

  shuffleBtn.addEventListener('click', () => {
    shuffleTiles();
  });

  // Start the game
  startLevel();

</script>

</body>
</html>
